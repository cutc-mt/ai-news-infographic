<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph - Custom StreamingとA2A統合</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;700&family=Yomogi&family=Zen+Kurenaido&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Kaisei Decol', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 20px;
            color: #f1f5f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--color-1) 0%, var(--color-2) 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .header .meta {
            font-family: 'Yomogi', cursive;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(51, 65, 85, 0.9) 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        .card-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--color-1) 0%, var(--color-2) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: var(--color-3);
            font-weight: 700;
        }
        .card p {
            font-family: 'Yomogi', cursive;
            font-size: 1rem;
            line-height: 1.8;
            color: #cbd5e1;
        }
        .highlight {
            background: linear-gradient(135deg, var(--color-1) 0%, var(--color-2) 100%);
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }
        .tag {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 3px;
            font-family: 'Yomogi', cursive;
        }
        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            color: #64748b;
            font-size: 0.9rem;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .fa-bounce {
            animation: bounce 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔄 LangGraph Custom Streaming</h1>
            <p class="meta">A2A統合でプロダクショングレードのストリーミングエージェント</p>
            <p class="meta">Indie Stack | 2026/02/17</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-stream fa-bounce"></i></div>
            <h2>①Custom Streaming: グラフからイベントを出力</h2>
            <p>LangGraphの<span class="highlight">カスタムストリーミング機能</span>を使用して、グラフからイベントをストリーミング出力。開発者は特定のメタデータをストリーミングし、進行状況をリアルタイムで追跡可能。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-file-code"></i></div>
            <h2>②getStreamWriter関数: ノード実装</h2>
            <p>ノード関数内で<span class="highlight">getStreamWriter</span>をインポートし、ライターオブジェクトを作成。ライターは辞書をストリーミングし、タイプ、ファイル名、インデックス、合計数などのメタデータを含めることができる。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-vial"></i></div>
            <h2>③デモスクリプト: 10ファイル処理</h2>
            <p>10個のファイルを処理するダミーグラフで実装。ファイル4と7は破損しており、各ファイルの処理に<span class="highlight">1.5秒</span>かかる。実行状態（error/done/summary）をストリーミングでリアルタイム報告。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-code-branch"></i></div>
            <h2>④streamまたはastream: 非同期ストリーミング</h2>
            <p><span class="highlight">astream</span>は非同期ストリーミングを許可。2つのオブジェクト（modeとchunk）を生成。modeは異なるストリーミングモード（customなど）にアクセス。chunkはライターが返すキーにアクセス可能。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-plug"></i></div>
            <h2>⑤A2A統合: エージェント間プロトコル</h2>
            <p>A2A（Agent-to-Agent）プロトコルと統合して、LangGraphのストリーミング機能と<span class="highlight">A2Aプロトコルのストリーミング機能</span>を組み合わせることで、プロダクショングレードのストリーミングエージェントを構築。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-server"></i></div>
            <h2>⑥A2A SDK: TaskStatusUpdateEvent</h2>
            <p>A2A SDKは<span class="highlight">task_update</span>と<span class="highlight">update_statusメソッド</span>を提供。state（task_state.working）とメッセージをストリーミング。クライアントは「1/10ファイル処理済み」のような進行状況を受け取る。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-terminal"></i></div>
            <h2>⑦サーバー実装: server.py</h2>
            <p>グラフをインポートし、streamの出力を<span class="highlight">message変数</span>に保存。A2A SDKのTaskUpdateクラスを使用して、update_statusメソッドでサーバーからクライアントにイベントをストリーミング。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-desktop"></i></div>
            <h2>⑧クライアント実装: client.py</h2>
            <p>ClientFactoryでA2Aサーバーに接続。<span class="highlight">streaming_mode=true</span>でストリーミングを強制。send_messageでメッセージを送信し、taskとupdateの2つのオブジェクトを生成。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-check-circle"></i></div>
            <h2>⑨イベント判定: TaskStatusUpdateEvent vs Artifact</h2>
            <p>updateが<span class="highlight">TaskStatusUpdateEvent</span>（ファイル処理などの中間進捗）か<span class="highlight">TaskArtifactUpdateEvent</span>（最終メッセージやファイル）かを判定。それぞれのイベントタイプに応じて適切な処理を実行。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-bolt"></i></div>
            <h2>⑩実行結果: リアルタイム進行報告</h2>
            <p>クライアント実行で<span class="highlight">「working 5/4 failed」</span>などのイベントをリアルタイムで受信。サーバーログでも同じ結果を確認。LangGraphのストリーミングとA2Aプロトコルのストリーミングが完全に統合されている。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-thumbs-up"></i></div>
            <h2>⑪ベストプラクティス: シンプルな統合</h2>
            <p>streamの出力を変数に保存し、A2A SDKのupdate_statusメソッドを使用してA2Aサーバーからクライアントへストリーミング。<span class="highlight">非常にシンプルで理解しやすい</span>統合方法が最高のアプローチ。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-rocket"></i></div>
            <h2>⑫ユースケース: ファイル処理の進行追跡</h2>
            <p>複数ファイルの並列処理、各ファイルの処理状態（成功/失敗）、全体の進行状況（例: 5/10完了）を<span class="highlight">リアルタイムで可視化</span>。ユーザーは長時間実行タスクの進行を即座に確認可能。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <h2>⑬エラーハンドリング: failedイベント</h2>
            <p>ファイル4と7が破損しているケースで、エラーが正しく<span class="highlight">「failed」</span>イベントとして報告されることを確認。正常なファイルは「done」イベント、最後に「summary」イベントで全体概要を報告。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-sync"></i></div>
            <h2>⑭非同期処理: astreamの利点</h2>
            <p>astreamを使用することで、<span class="highlight">ノンブロッキングなストリーミング</span>を実現。他のタスクと並行してストリーミング処理を実行でき、アプリケーションの応答性を維持。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-layer-group"></i></div>
            <h2>⑮モード切り替え: custom + others</h2>
            <p>customストリーミングモードだけでなく、<span class="highlight">他のストリーミングモードと並行して使用</span>可能。柔軟なストリーミング戦略を採用し、異なるタイプのイベントを同時に処理。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-cogs"></i></div>
            <h2>⑯カスタマイズ: typeキーの活用</h2>
            <p>streamWriterで設定したtypeキー（error/done/summary）をchunk.getでアクセス。<span class="highlight">独自のイベントタイプ</span>を定義し、アプリケーション固有のストリーミング要件に対応。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-project-diagram"></i></div>
            <h2>⑰アーキテクチャ: グラフ → A2A</h2>
            <p>LangGraphでグラフを構築 → streamでカスタムイベントをストリーミング → A2A SDKで<span class="highlight">サーバーからクライアントへ転送</span>。クリーンでスケーラブルなストリーミングアーキテクチャ。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-globe"></i></div>
            <h2>⑱製品化に向けた: Production Grade</h2>
            <p>開発環境だけでなく、<span class="highlight">プロダクション環境での使用</span>を想定した実装。エラー処理、進行追跡、ステータス報告など、本番運用に必要な機能を完備。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-book"></i></div>
            <h2>⑱前提知識: LangGraph & A2A</h2>
            <p>この動画を理解するには、<span class="highlight">LangGraphとA2Aプロトコル</span>の基本知識が必要。入門動画を視聴し、基本概念を理解してからこの高度なストリーミング統合に取り組むことが推奨される。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-star"></i></div>
            <h2>⑱まとめ: 最高の統合方法</h2>
            <p>LangGraphのカスタムストリーミングとA2Aプロトコルのストリーミングを組み合わせることで、<span class="highlight">プロダクショングレードのストリーミングエージェント</span>を構築可能。シンプルで理解しやすく、非常に強力。</p>
        </div>

        <div class="footer">
            <p>Generated by Claude Code | ソース: Indie Stack</p>
            <p>タグ: <span class="tag">#LangGraph</span> <span class="tag">#A2A</span> <span class="tag">#Streaming</span> <span class="tag">#Python</span></p>
        </div>
    </div>
</body>
</html>