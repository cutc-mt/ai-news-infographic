<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foundry Local + GitHub Copilot SDK でローカルLLMを実行</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kaisei+Decol&family=Yomogi&family=Zen+Kurenaido&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-1: #EA580C;
            --color-2: #F97316;
            --color-3: #FFEDD5;
            --color-4: #C2410C;
            --color-5: #FDBA74;
            --color-accent: #F59E0B;
            --bg-color: #FFF7ED;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--color-1) 0%, var(--color-2) 100%);
            color: white;
            border-radius: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 40px rgba(234, 88, 12, 0.3);
        }

        header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            font-family: 'Kaisei Decol', serif;
        }

        header .subtitle {
            font-size: 20px;
            opacity: 0.9;
        }

        header .date {
            font-size: 14px;
            margin-top: 15px;
            opacity: 0.7;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        @media (max-width: 1400px) {
            .grid-container { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 1000px) {
            .grid-container { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .grid-container { grid-template-columns: 1fr; }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-1), var(--color-2));
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(234, 88, 12, 0.2);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--color-1);
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 12px;
            font-family: 'Kaisei Decol', serif;
            color: var(--color-4);
            font-weight: 700;
        }

        .card p {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #555;
        }

        .highlight {
            background: linear-gradient(135deg, var(--color-1), var(--color-2));
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            font-size: 14px;
            color: #777;
        }

        footer a {
            color: var(--color-1);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cogs"></i> Foundry Local + GitHub Copilot SDK</h1>
            <p class="subtitle">ローカルLLMをCopilot SDKでオーケストレーション・デバイス推論</p>
            <p class="date">2026-02-19</p>
        </header>

        <div class="grid-container">
            <div class="card">
                <div class="card-icon"><i class="fas fa-project-diagram"></i></div>
                <h2>①アーキテクチャ概要</h2>
                <p>GitHub Copilot SDKを<span class="highlight">オーケストレーター</span>として使用し、Foundry Localのモデルをデバイス推論に活用。クラウドベースのLLMとローカルモデルを組み合わせたハイブリッド構成を実現。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-download"></i></div>
                <h2>②前提条件</h2>
                <p>3つのコンポーネントが必要：<span class="highlight">OpenAIライブラリ</span>（Foundry LocalがOpenAI API互換）、Foundry Local、GitHub Copilot SDK。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-wrench"></i></div>
                <h2>③ツール1: LocalInference</h2>
                <p>Foundry Local Toolクラスを作成し、<span class="highlight">Qwenモデル</span>を使用してローカル推論を実行。モデルがローカルにない場合は自動ダウンロードされる。エンドポイントはlocalhostの動的なポート番号を使用。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-server"></i></div>
                <h2>④Foundry Localマネージャー</h2>
                <p>マネージャーインスタンスが<span class="highlight">Foundry Localの全てを管理</span>。モデルIDを指定してサービスを起動し、エンドポイントURLとポート番号を動的に取得。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-calculator"></i></div>
                <h2>⑤ツール2-4</h2>
                <p><span class="highlight">Calculator</span>は計算式評価、<span class="highlight">JSON Pretty</span>はJSON整形、<span class="highlight">Rewrite Text</span>はテキストの短縮・箇条書き化・フォーマル化。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-list-alt"></i></div>
                <h2>⑥ツールレジストリ</h2>
                <p>ToolSpecクラスでbuild_tools関数を作成し、各ツールの<span class="highlight">名前・説明・入力スキーマ</span>を定義。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-route"></i></div>
                <h2>⑦ルータープロンプト</h2>
                <p><span class="highlight">Copilot SDKがどのツールを呼ぶか決定</span>する必要がある。ルーター用プロンプトを構築し、利用可能なツールのリスト（JSON形式）を提供。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-traffic-light"></i></div>
                <h2>⑧ルーティングルール</h2>
                <p>特定のキーワードに基づいてツールを選択するルールを定義。"local/offline/AI related" → <span class="highlight">Foundry Local</span>、"evaluation/calculation" → Calculator。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-brain"></i></div>
                <h2>⑨decide_route関数</h2>
                <p>ユーザー入力とツールリストに基づいてプロンプトを構築し、<span class="highlight">GitHub Copilot SDKのsession.send_and_wait()</span>で実行。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-magic"></i></div>
                <h2>⑩finalize_with_tool関数</h2>
                <p>ツールの出力をそのまま返すのではなく、<span class="highlight">Copilot SDKで出力を改善</span>。エラーの場合は次のステップを説明、有効な出力場合は明確性を向上させる。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-play"></i></div>
                <h2>⑪main関数</h2>
                <p>まずFoundry Localサービスを起動し、次に<span class="highlight">Copilotクライアントを初期化</span>。Copilot SDKで使用するモデル（GPT-4など）を指定。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-terminal"></i></div>
                <h2>⑫デモ1: 挨拶</h2>
                <p>挨拶メッセージでは<span class="highlight">ルーター決定はnone</span>。ツールは不要と判断され、Copilot SDKが自力で応答。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-map-marked-alt"></i></div>
                <h2>⑬デモ2: 旅行の質問</h2>
                <p>「シアトルで訪れるべき場所は？」という質問も<span class="highlight">ルーター決定はnone</span>。Copilot SDKが一般的な旅行アドバイスを提供。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-plus"></i></div>
                <h2>⑭デモ3: 計算</h2>
                <p>数学的な質問では<span class="highlight">ルーター決定はCalculator</span>。Python関数が実行され、計算結果が返される。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-pen-fancy"></i></div>
                <h2>⑮デモ4: テキスト書き換え</h2>
                <p>「このテキストをより良く書き換えて」というリクエストで<span class="highlight">Rewrite Textツールが呼び出され</span>。「I am sick to go to school」が「I'm too sick to go to school」に改善。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-exclamation"></i></div>
                <h2>⑯デモ5: AI有害性の質問</h2>
                <p>概念的な質問では<span class="highlight">ルーター決定はnone</span>。Copilot SDKがAIリスクに関する概念的回答を提供。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-sliders-h"></i></div>
                <h2>⑰デモ6: ローカルAIモデル</h2>
                <p>「ローカルAIモデルをファインチューニングする手順」では<span class="highlight">ルーター決定はFoundry Local</span>。ローカル推論ツールが呼び出される。</p>
            </div>

            <div class="card">
                <div class="card-icon"><i class="fas fa-shield-alt"></i></div>
                <h2>⑱ユースケース</h2>
                <p><span class="highlight">高額なクエリ</span>や<span class="highlight">データセンシティブな操作</span>に最適。機密情報やLLM呼び出しがすべてローカルで実行される。</p>
            </div>
        </div>

        <footer>
            <p><i class="fas fa-calendar-alt"></i> 作成日: 2026-02-19 | <i class="fas fa-video"></i> 動画: <a href="https://youtu.be/WohotwTKg3E" target="_blank">How to Run Local LLMs with Foundry Local and GitHub Copilot SDK</a></p>
        </footer>
    </div>
</body>
</html>
