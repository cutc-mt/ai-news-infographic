<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foundry Local + GitHub Copilot SDK でローカルLLMを実行</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --color-1: #EA580C;
            --color-2: #F97316;
            --color-3: #FB923C;
            --color-4: #C2410C;
            --color-5: #FDBA74;
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-cogs"></i> Foundry Local + GitHub Copilot SDK</h1>
        <p class="subtitle">ローカルLLMをCopilot SDKでオーケストレーション・デバイス推論</p>
    </header>

    <main>
        <div class="card">
            <div class="card-icon"><i class="fas fa-project-diagram"></i></div>
            <h2>①アーキテクチャ概要: Copilot SDKがオーケストレーター・Foundry Localが推論エンジン</h2>
            <p>GitHub Copilot SDKを<span class="highlight">オーケストレーター</span>として使用し、Foundry Localのモデルをデバイス推論に活用。クラウドベースのLLMとローカルモデルを組み合わせたハイブリッド構成を実現。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-download"></i></div>
            <h2>②前提条件: OpenAI・Foundry Local・Copilot SDKのインストール</h2>
            <p>実装には3つのコンポーネントが必要：<span class="highlight">OpenAIライブラリ</span>（Foundry LocalがOpenAI API互換）、Foundry Local、GitHub Copilot SDK。これらをインストールして環境を準備。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-wrench"></i></div>
            <h2>③ツール1: LocalInferenceクラス・Qwenモデルでローカル推論</h2>
            <p>Foundry Local Toolクラスを作成し、<span class="highlight">Qwenモデル</span>を使用してローカル推論を実行。モデルがローカルにない場合は自動ダウンロードされる。エンドポイントはlocalhostの動的なポート番号を使用。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-server"></i></div>
            <h2>④Foundry Localマネージャー: サービス起動とエンドポイント取得</h2>
            <p>マネージャーインスタンスがFoundry Localの<span class="highlight">全てを管理</span>。モデルIDを指定してサービスを起動し、エンドポイントURLとポート番号を動的に取得。クライアントはOpenAI互換のAPIで通信。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-calculator"></i></div>
            <h2>⑤ツール2-4: 電卓・JSON整形・テキスト書き換え</h2>
            <p>残り3つのツールは純粋なPythonコードで実装。<span class="highlight">Calculator</span>は計算式評価、<span class="highlight">JSON Pretty</span>はJSON整形、<span class="highlight">Rewrite Text</span>はテキストの短縮・箇条書き化・フォーマル化。ツールは任意のカスタムコードでOK。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-list-alt"></i></div>
            <h2>⑥ツールレジストリ: ToolSpecクラスでツールをコレクション化</h2>
            <p>ToolSpecクラスでbuild_tools関数を作成し、各ツールの<span class="highlight">名前・説明・入力スキーマ</span>を定義。Local Foundryはprompt、Calculatorはexpression、JSONはtext、Rewriteはtextとstyleを必要とする。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-route"></i></div>
            <h2>⑦ルータープロンプト: ツール選択のための指示構築</h2>
            <p>ツールは自動的に呼び出されないため、<span class="highlight">Copilot SDKがどのツールを呼ぶか決定</span>する必要がある。ルーター用プロンプトを構築し、利用可能なツールのリスト（JSON形式）を提供。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-traffic-light"></i></div>
            <h2>⑧ルーティングルール: キーワードベースのツール選択</h2>
            <p>特定のキーワードに基づいてツールを選択するルールを定義。"local/offline/AI related/on-device inference" → <span class="highlight">Foundry Local</span>、"evaluation/calculation" → Calculator、"JSON" → JSON Pretty、"shortening/formalizing" → Rewrite Text。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-brain"></i></div>
            <h2>⑨decide_route関数: Copilot SDKでツール選択を実行</h2>
            <p>ユーザー入力とツールリストに基づいてプロンプトを構築し、<span class="highlight">GitHub Copilot SDKのsession.send_and_wait()</span>で実行。ツール名・引数・選択理由を含む決定を取得。エラーハンドリングも実装。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-magic"></i></div>
            <h2>⑩finalize_with_tool関数: ツール出力の改善</h2>
            <p>ツールの出力をそのまま返すのではなく、<span class="highlight">Copilot SDKで出力を改善</span>。エラーの場合は次のステップを説明、有効な出力場合は一次情報として使用し明確性を向上させる。再度session.send_and_wait()を実行。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-play"></i></div>
            <h2>⑪main関数: Foundry Local起動とCopilotクライアント初期化</h2>
            <p>まずFoundry Localサービスを起動し、次に<span class="highlight">Copilotクライアントを初期化</span>。Copilot SDKで使用するモデル（GPT-4など）を指定。ユーザーへのプロンプト入力を待ち受け、exit/quitで終了。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-terminal"></i></div>
            <h2>⑫デモ1: 挨拶「hi」→ツールなしでCopilotが直接応答</h2>
            <p>挨拶メッセージでは<span class="highlight">ルーター決定はnone</span>。ツールは不要と判断され、Copilot SDKが自力で応答。汎用的な会話にはツールを使用せず、Copilotの能力で対応。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-map-marked-alt"></i></div>
            <h2>⑬デモ2: 旅行の質問→ツールなしで一般アドバイス</h2>
            <p>「シアトルで訪れるべき場所は？」という質問も<span class="highlight">ルーター決定はnone</span>。関連するツールが定義されていないため、Copilot SDKが一般的な旅行アドバイスを提供。汎用的な質問には直接対応。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-plus"></i></div>
            <h2>⑭デモ3: 計算「2+3」→Calculatorツールが呼び出される</h2>
            <p>数学的な質問では<span class="highlight">ルーター決定はCalculator</span>。理由は「ユーザーが単純な数式を評価するよう要求したため」。Python関数が実行され、計算結果が返される。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-pen-fancy"></i></div>
            <h2>⑮デモ4: テキスト書き換え→Rewrite Textツールが呼び出される</h2>
            <p>「このテキストをより良く書き換えて」というリクエストで<span class="highlight">Rewrite Textツールが呼び出され</span>。「I am sick to go to school」が「I'm too sick to go to school」に改善。テキスト整形タスクを担当。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-exclamation"></i></div>
            <h2>⑯デモ5: AI有害性の質問→ツールなしで概念的回答</h2>
            <p>「AIが有害である理由を1行で説明」という概念的な質問では<span class="highlight">ルーター決定はnone</span>。定義されたツールには該当せず、Copilot SDKがAIリスクに関する概念的回答を提供。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-sliders-h"></i></div>
            <h2>⑰デモ6: ローカルAIモデルのファインチューニング→Foundry Localツール</h2>
            <p>「ローカルAIモデルをファインチューニングする手順」では<span class="highlight">ルーター決定はFoundry Local</span>。理由は「ユーザーが明示的にローカルAIモデルと言及したため」。ローカル推論ツールが呼び出される。</p>
        </div>

        <div class="card">
            <div class="card-icon"><i class="fas fa-shield-alt"></i></div>
            <h2>⑱ユースケース: 高額なクエリやデータセンシティブな操作に最適</h2>
            <p>この構成は<span class="highlight">高額なクエリ</span>や<span class="highlight">データセンシティブな操作</span>に最適。機密情報やLLM呼び出しがすべてローカルで実行されるため、クラウドにデータを送りたくない場合に完璧なソリューション。</p>
        </div>
    </main>

    <footer>
        <p><i class="fas fa-calendar-alt"></i> 作成日: 2026-02-20 | <i class="fas fa-video"></i> 動画: <a href="https://youtu.be/WohotwTKg3E" target="_blank">How to Run Local LLMs with Foundry Local and GitHub Copilot SDK</a></p>
    </footer>
</body>
</html>
